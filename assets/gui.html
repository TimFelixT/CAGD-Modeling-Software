<html>

<head>
    <style type="text/css">
        /* Tab Style */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 20px 20px;
            transition: 0.3s;
        }
        .tab button:hover {
            background-color: #ddd;
        }
        .tab button.active {
            background-color: #ccc;
        }
        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }
        /* Accordion Style */
        .accordion {
            background-color: #eee;
            color: #444;
            cursor: pointer;
            padding: 20px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
        }
        .active,
        .accordion:hover {
            background-color: #ccc;
        }
        .panel {
            padding: 20px 20px;
            background-color: white;
            display: none;
            overflow: hidden;
        }
    </style>
    <script>
        /* TabLayout Functions */
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
        window.addEventListener('load', (event) => {
            document.getElementById("defaultOpen").click();
        });
        /* Accordion Functions */
        function toggleAccordion(accordion) {
            accordion.classList.toggle("active");
            var panel = accordion.nextElementSibling;
            if (panel.style.display === "block") {
                panel.style.display = "none";
            } else {
                panel.style.display = "block";
            }
        }
        /* Kurve hinzufügen */
        function addCurve(){
            let s = document.querySelector("#kurve");
            let button = document.createElement("button");
            button.classList.add("accordion");
            button.innerText = "Bezier Kurve";
            button.addEventListener("click", function(){ toggleAccordion(this); });
            s.appendChild(button);
            let panel = document.createElement("div");
            panel.classList.add("panel");
            s.appendChild(panel);

            let btnPanel = document.createElement("div");
            panel.appendChild(btnPanel);
            let deleteBtn = document.createElement("button");
            deleteBtn.innerText = "Letzten Punkt löschen";
            let addBtn = document.createElement("button");
            addBtn.innerText = "Neuen Punkt hinzufügen";
            addBtn.addEventListener("click", function(){ addNewPoint(this) });
            deleteBtn.addEventListener("click", function(){ deleteLastPoint(this) });
            btnPanel.appendChild(addBtn);
            btnPanel.appendChild(deleteBtn);

            for (let i=0; i < arguments.length; i+=4) {
                if (arguments[i+2] == undefined && arguments[i+3] == undefined) {
                    /* Daten zu den Punkten - Kommt nur einmal pro Kurve vor */
                    panel.setAttribute("data-index", arguments[i]);
                    arguments[i+1] == 0 ? button.innerText+=" (Bernstein Kurve)" : button.innerText+=" (DeCasteljau Kurve)" ;
                } else {
                    /* Ein Kontrollpunkt */
                    let pointcontainer = document.createElement("div");
                    pointcontainer.style.display = "inline-block;"
                    addPoint(pointcontainer, arguments[i], i);
                    addPoint(pointcontainer, arguments[i+1], i+1);
                    addPoint(pointcontainer, arguments[i+2], i+2);
                    addPoint(pointcontainer, arguments[i+3], i+3);
                    panel.appendChild(pointcontainer);
                }


            }
        }
        function addPoint(pointcontainer, value, index) {
            let input = document.createElement("input");
            input.setAttribute("type", "number");
            input.setAttribute("step", "0.001");
            input.setAttribute("data-index", index);
            input.addEventListener("change", function(){ pointEdited(this); });
            input.value = value;
            pointcontainer.appendChild(input);
        }
        function pointEdited(input){
            let dataIndex = input.getAttribute("data-index");
            let value = input.value;
            let curveIndex = input.parentNode.parentNode.getAttribute("data-index");
            OnPointChange(Math.floor(dataIndex/4), dataIndex%4, value, curveIndex);
                     
        }
        function addNewPoint(addBtn){
            let panel = addBtn.parentNode.parentNode;
            let bezierCurveIndex = panel.getAttribute("data-index");
            let htmlPointIndex = parseInt(panel.lastChild.lastChild.getAttribute("data-index"), 10) +1;
            let pointcontainer = document.createElement("div");
            pointcontainer.style.display = "inline-block;"
            for (let i=0; i<4; i++) {
                //Neuer Punkt ist (0, 0, 0, 1)
                addPoint(pointcontainer, 0, htmlPointIndex+i);
            }
            panel.appendChild(pointcontainer);
            OnAddNewPoint(0, 0, 0, 1, bezierCurveIndex);

        }
        function deleteLastPoint(deleteBtn){
            let panel = deleteBtn.parentNode.parentNode;
            if (panel.childElementCount <= 4) {
                //Nicht möglich - 3 Punkte müssen mindestens vorhanden sein (Der erste div ist kein Punkt, daher 4 bei if)
                OnDeleteLastPoint(0, -1);
            } else {
                let bezierCurveIndex = panel.getAttribute("data-index");
                let remove = panel.lastChild;
                panel.removeChild(remove);
                OnDeleteLastPoint(bezierCurveIndex, 1);
            } // OnDeleteLastPoint - 1 für kann gelöscht werden, -1 zu wenig Einträge
        }
        function resetCurves(){
            let kurven = document.querySelector("#kurve");
            kurven.innerHTML = "";
            let heading = document.createElement("h3");
            heading.innerText = "Bezier - Kurve";
            kurven.appendChild(heading);
            let updateBtn = document.createElement("button");
            updateBtn.innerText = "Aktualisiere Kontrollpunkte";
            updateBtn.addEventListener("click", function(){ resetCurves() });
            kurven.appendChild(updateBtn);
            OnResetCurves();
        }
        
    </script>
</head>

<body>
    <div class="tab">
        <button class="tablinks" onclick='openTab(event, "kurve")' id="defaultOpen"> Bezier Kurve </button>
        <button class="tablinks" onclick='openTab(event, "flaeche")'> Bezier Fl&auml;che </button>
        <button class="tablinks" onclick='openTab(event, "einstellungen")'> Einstellungen </button>
    </div>
    <div id="kurve" class="tabcontent">
        <h3>Bezier - Kurve</h3>
        <button onclick='resetCurves()'>Aktualisiere Kontrollpunkte</button>
    </div>
    <div id="flaeche" class="tabcontent">
        <h3>Bezier - Fl&auml;che</h3>
    </div>
    <div id="einstellungen" class="tabcontent">
        <h3>Einstellungen</h3>
        <div>
            <label for="bernstein">Bernsteinstein-Bezierkurve anzeigen</label>
            <input type="radio" id="bernstein" name="drawtype" value="bernstein" onclick='OnToggleBezier(0)'>
            <label for="decasteljau">DeCasteljau-Bezierkurve anzeigen</label>
            <input type="radio" id="decasteljau" name="drawtype" value="decasteljau" checked="checked" onclick='OnToggleBezier(1)'>
        </div>
        <div>
            <button onclick='OnToggleHighlightControlpoints()'>Toggle Kontrollpunkte hervorheben</button>
        </div>
        <div>
            <button onclick='OnDegreeIncrease()'>Gradanhebung durchführen</button>
        </div>
    </div>
</body>

</html>